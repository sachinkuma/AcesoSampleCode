/*! rtsp.io-client-js - v0.0.1 - 2015-08-31
* Copyright (c) 2015 ; Licensed  */

!function(){"use strict"}();var dummyDebug={};dummyDebug.log=dummyDebug.trace=dummyDebug.status=function(a){console.log(a)};var debug=window.debug||dummyDebug,RTSPIOClient={socket:null,url:null,proxyServerUrl:"",ip:"",device:"",roomNumber:"",events:{initialized:"rtspio.initialized",beginningOfStream:"rtspio.beginningOfStream",endOfStream:"rtspio.endOfStream",error:"rtspio.error",playing:"rtspio.playing",loaded:"rtspio.loaded",paused:"rtspio.paused",currentTime:"rtspio.currentTime",announced:"rtspio.announced",teardown:"rtspio.teardown",disconnect:"rtspio.disconnect"},connect:function(){debug.log("proxy client connect"),this.socket=this.io(this.proxyServerUrl,{forceNew:!0}),this.initListeners(),this.socket.connected||(this.socket.connect(this.proxyServerUrl),debug.log("connecting to "+this.proxyServerUrl))},disconnect:function(){this.socket&&(this.socket.off("message"),this.socket.off("rtspio.handshake"),this.socket.off("rtspio.ended"),this.socket.off("rtspio.loaded"),this.socket.off("rtspio.playing"),this.socket.off("rtspio.paused"),this.socket.off("rtspio.currentTime"),this.socket.off("rtspio.announced"),this.socket.off("rtspio.teardown"),this.socket.off("rtspio.error"),this.socket.disconnect(),delete this.socket,this.socket=null,this.url=null,debug.log("proxy disconnected!"))},initEventObj:function(a,b){var c=new Event(a);for(var d in b)c[d]=b[d];return c},initListeners:function(){var a=this;this.socket.once("connect",function(){debug.log("proxy connected successfully!"),a._emitHandshake()}),this.socket.once("disconnect",function(){debug.log("proxy disconnected!");var b=a.initEventObj(a.events.disconnect,{});document.dispatchEvent(b)}),this.socket.on("message",function(a){debug.log(a)}),this.socket.on("connect_error",function(a){debug.log("proxy connection error! "+a)}),this.socket.on("reconnect",function(){debug.log("proxy re-connected successfully!")}),this.socket.on("reconnecting",function(){debug.log("proxy re-connecting...")}),this.socket.on("reconnect_error",function(a){debug.log("proxy re-connection error! "+a)}),this.socket.on("rtspio.handshake",function(){debug.log("handshake event"),a._emitLoad()}),this.socket.on("rtspio.error",function(b,c,d){debug.log(b),debug.log(c),debug.log(d),debug.log("error event");var e=a.initEventObj(a.events.error,{code:b,notice:c,param:d});document.dispatchEvent(e)}),this.socket.on("rtspio.beginning",function(b,c){debug.log(b),debug.log(c),debug.log("beginning event");var d=a.initEventObj(a.events.beginningOfStream,{notice:b,param:c});document.dispatchEvent(d)}),this.socket.on("rtspio.ended",function(b,c){debug.log(b),debug.log(c),debug.log("ended event");var d=a.initEventObj(a.events.endOfStream,{notice:b,param:c});document.dispatchEvent(d)}),this.socket.on("rtspio.loaded",function(b,c){debug.log(b),debug.log(c),debug.log("loaded event");var d=a.initEventObj(a.events.loaded,{notice:b,param:c});document.dispatchEvent(d)}),this.socket.on("rtspio.playing",function(b,c){debug.log("playing event"),debug.log(b),debug.log(c);var d=a.initEventObj(a.events.playing,{notice:b,param:c});document.dispatchEvent(d)}),this.socket.on("rtspio.paused",function(b,c){debug.log("paused event"),debug.log(b),debug.log(c);var d=a.initEventObj(a.events.paused,{notice:b,param:c});document.dispatchEvent(d)}),this.socket.on("rtspio.currentTime",function(b,c){if(debug.log("currentTime event"),debug.log(b),debug.log(c),c.indexOf("Position:")>=0){var d=c.trim().split("\r\n");c={};for(var e=0;e<d.length;e++){var f=d[e].trim().split(":");f.length>1&&(c[f[0].trim()]=f[1].trim())}}var g=a.initEventObj(a.events.currentTime,{notice:b,param:c});document.dispatchEvent(g)}),this.socket.on("rtspio.announced",function(b,c){debug.log("announced event"),debug.log(b),debug.log(c);var d=a.initEventObj(a.events.announced,{notice:b,param:c});document.dispatchEvent(d)}),this.socket.on("rtspio.teardown",function(b,c){debug.log("teardown event"),debug.log(b),debug.log(c),debug.log("We received the Teardown Callback");var d=a.initEventObj(a.events.teardown,{notice:b,param:c});document.dispatchEvent(d),a.kill()})},_emitHandshake:function(){debug.log("io handshake"),this.socket.emit("handshake",this.ip,this.roomNumber,this.device)},_emitLoad:function(){debug.log("io load"),this.socket.emit("load",this.url)},_emitPlay:function(a,b){debug.log("io play"),this.socket.emit("play",a,b)},_emitPause:function(){debug.log("io pause"),this.socket.emit("pause")},_emitCurrentTime:function(){debug.log("io currentTime"),this.socket.emit("currentTime")},_emitTeardown:function(){debug.log("io teardown"),this.socket.emit("teardown")},play:function(a,b){debug.log("video play, scale="+a+" offset="+b),this._emitPlay(a,b)},pause:function(){debug.log("video pause"),this._emitPause()},teardown:function(){debug.log("video teardown"),this._emitTeardown()},getCurrentTime:function(){debug.log("video getCurrentTime"),this._emitCurrentTime()},load:function(a){this.url=a||this.url,debug.log("loading stream "+this.url),debug.log("destination "+this.ip),this.connect()},kill:function(){this.disconnect()},init:function(a){var b=this;if(debug.log("Initialize client"),b.setProperties(a),window.io)debug.log("socket.io lib was already loaded previously"),b.io=window.io;else{var c=this.proxyServerUrl+"/socket.io/socket.io.js";debug.log("loading socket.io lib from "+c),$.getScript(c,function(a,c,d){debug.log("socket.io lib loaded"),b.io=window.io;var e=b.initEventObj(b.events.initialized,{});document.dispatchEvent(e)})}},setProperties:function(a){for(var b in a)this[b]=a[b]},setIp:function(a){this.ip=a},setDevice:function(a){this.device=a},setUrl:function(a){this.url=a},setProxyServerUrl:function(a){this.proxyServerUrl=a},setRoomNumber:function(a){this.roomNumber=a}};
//# sourceMappingURL=rtsp.io-client-js.map